// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  birthDate DateTime @map("birth_date")
  gender    String
  bloodType String?  @map("blood_type")
  height    Float?
  weight    Float?
  
  // Lifestyle habits stored as JSON
  lifestyleHabits Json? @map("lifestyle_habits")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relations
  healthRecords        HealthRecord[]
  medicalRecords       MedicalRecord[]
  medications          Medication[]
  genomicData          GenomicData[]
  familyHistory        FamilyHistory[]
  familyRiskAssessments FamilyRiskAssessment[]
  documents            Document[]
  predictions          Prediction[]
  appointments         Appointment[]
  recommendations      Recommendation[]
  recommendationEffectiveness RecommendationEffectiveness[]
  wearableDeviceConfigs WearableDeviceConfig[]
  
  @@map("users")
}

model HealthRecord {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  recordType   String   @map("record_type")
  data         Json
  recordedDate DateTime @map("recorded_date")
  createdAt    DateTime @default(now()) @map("created_at")
  
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  vitalSigns VitalSign[]
  
  @@map("health_records")
}

model VitalSign {
  id              String   @id @default(cuid())
  healthRecordId  String   @map("health_record_id")
  type            String
  value           Json
  unit            String
  measuredAt      DateTime @map("measured_at")
  
  healthRecord HealthRecord @relation(fields: [healthRecordId], references: [id], onDelete: Cascade)
  
  @@map("vital_signs")
}

model MedicalRecord {
  id                   String   @id @default(cuid())
  userId               String   @map("user_id")
  hospitalName         String   @map("hospital_name")
  department           String
  doctorName           String   @map("doctor_name")
  diagnosisCode        String?  @map("diagnosis_code")
  diagnosisDescription String?  @map("diagnosis_description")
  doctorNotes          String?  @map("doctor_notes")
  cost                 Float?
  visitDate            DateTime @map("visit_date")
  createdAt            DateTime @default(now()) @map("created_at")
  
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  testResults  TestResult[]
  prescriptions Prescription[]
  
  @@map("medical_records")
}

model TestResult {
  id              String   @id @default(cuid())
  medicalRecordId String   @map("medical_record_id")
  testCategory    String   @map("test_category") // blood, urine, imaging, etc.
  testSubcategory String?  @map("test_subcategory") // cbc, liver_function, etc.
  testName        String   @map("test_name")
  testItems       Json     @map("test_items") // Array of TestItem objects
  overallStatus   String   @map("overall_status") // normal, abnormal, critical, etc.
  testDate        DateTime @map("test_date")
  laboratoryName  String?  @map("laboratory_name")
  doctorNotes     String?  @map("doctor_notes")
  imageFiles      Json?    @map("image_files") // Array of file paths for imaging tests
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  medicalRecord MedicalRecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)
  
  @@index([testCategory, testDate])
  @@index([testName, testDate])
  @@index([overallStatus])
  @@map("test_results")
}

model Prescription {
  id              String   @id @default(cuid())
  medicalRecordId String   @map("medical_record_id")
  medicationName  String   @map("medication_name")
  dosage          String
  frequency       String
  duration        String?
  instructions    String?
  
  medicalRecord MedicalRecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)
  
  @@map("prescriptions")
}

model Medication {
  id          String    @id @default(cuid())
  userId      String    @map("user_id")
  name        String
  genericName String?   @map("generic_name")
  dosage      String
  frequency   String
  route       String?   // oral, injection, topical, etc.
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  isActive    Boolean   @default(true) @map("is_active")
  purpose     String?   // indication for use
  prescribedBy String?  @map("prescribed_by")
  pharmacy    String?
  notes       String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  
  user               User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  dosageLogs         DosageLog[]
  sideEffects        SideEffect[]
  medicationSchedules MedicationSchedule[]
  
  @@map("medications")
}

model DosageLog {
  id           String   @id @default(cuid())
  medicationId String   @map("medication_id")
  takenAt      DateTime @map("taken_at")
  dosageTaken  String   @map("dosage_taken")
  notes        String?
  
  medication Medication @relation(fields: [medicationId], references: [id], onDelete: Cascade)
  
  @@map("dosage_logs")
}

model SideEffect {
  id           String   @id @default(cuid())
  medicationId String   @map("medication_id")
  effectName   String   @map("effect_name")
  severity     String   // mild, moderate, severe
  description  String?
  startDate    DateTime @map("start_date")
  endDate      DateTime? @map("end_date")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  
  medication Medication @relation(fields: [medicationId], references: [id], onDelete: Cascade)
  
  @@map("side_effects")
}

model DrugInteraction {
  id                String   @id @default(cuid())
  drug1Name         String   @map("drug1_name")
  drug2Name         String   @map("drug2_name")
  interactionType   String   @map("interaction_type") // major, moderate, minor
  severity          String   // contraindicated, serious, significant, minor
  description       String
  clinicalEffect    String?  @map("clinical_effect")
  mechanism         String?
  management        String?
  isActive          Boolean  @default(true) @map("is_active")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@index([drug1Name, drug2Name])
  @@index([interactionType])
  @@map("drug_interactions")
}

model MedicationSchedule {
  id           String   @id @default(cuid())
  medicationId String   @map("medication_id")
  timeOfDay    String   @map("time_of_day") // morning, afternoon, evening, night
  scheduledTime String  @map("scheduled_time") // HH:MM format
  dosage       String
  instructions String?
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  
  medication Medication @relation(fields: [medicationId], references: [id], onDelete: Cascade)
  
  @@map("medication_schedules")
}

model GenomicData {
  id               String   @id @default(cuid())
  userId           String   @map("user_id")
  sourcePlatform   String   @map("source_platform")
  filePath         String?  @map("file_path")
  snpData          Json?    @map("snp_data") // Encrypted JSON storage
  analysisResults  Json?    @map("analysis_results") // Encrypted JSON storage
  uploadedAt       DateTime @default(now()) @map("uploaded_at")
  
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  riskAssessments RiskAssessment[]
  snpRecords      SNPRecord[]
  
  @@map("genomic_data")
}

model SNPRecord {
  id            String   @id @default(cuid())
  genomicDataId String   @map("genomic_data_id")
  rsid          String
  chromosome    String
  position      BigInt
  genotype      String
  gene          String?
  consequence   String?
  createdAt     DateTime @default(now()) @map("created_at")
  
  genomicData GenomicData @relation(fields: [genomicDataId], references: [id], onDelete: Cascade)
  
  @@index([rsid])
  @@index([chromosome, position])
  @@index([gene])
  @@map("snp_records")
}

model RiskAssessment {
  id                 String   @id @default(cuid())
  userId             String   @map("user_id")
  genomicDataId      String?  @map("genomic_data_id")
  diseaseType        String   @map("disease_type")
  riskScore          Float    @map("risk_score")
  percentile         Float?
  contributingFactors Json?   @map("contributing_factors")
  calculatedAt       DateTime @default(now()) @map("calculated_at")
  
  genomicData GenomicData? @relation(fields: [genomicDataId], references: [id], onDelete: SetNull)
  
  @@map("risk_assessments")
}

model FamilyHistory {
  id           String  @id @default(cuid())
  userId       String  @map("user_id")
  relationship String  // father, mother, sibling, child, grandparent, etc.
  name         String?
  gender       String? // male, female, unknown
  birthYear    Int?    @map("birth_year")
  deathYear    Int?    @map("death_year")
  isAlive      Boolean @default(true) @map("is_alive")
  
  // Family tree positioning
  generation   Int     @default(0) // 0 = user, -1 = parents, -2 = grandparents, +1 = children
  position     Int     @default(0) // position within generation for layout
  parentId     String? @map("parent_id") // reference to parent in family tree
  
  // Medical information
  conditions   Json?   // array of medical conditions
  causeOfDeath String? @map("cause_of_death")
  
  // Metadata
  notes        String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Self-referencing relationship for family tree structure
  parent   FamilyHistory?  @relation("FamilyTreeRelation", fields: [parentId], references: [id])
  children FamilyHistory[] @relation("FamilyTreeRelation")
  
  @@map("family_history")
}

model GeneticCondition {
  id                String   @id @default(cuid())
  name              String   @unique
  icd10Code         String?  @map("icd10_code")
  category          String   // cardiovascular, cancer, neurological, metabolic, etc.
  inheritancePattern String? @map("inheritance_pattern") // autosomal_dominant, autosomal_recessive, x_linked, etc.
  prevalence        Float?   // population prevalence (0-1)
  penetrance        Float?   // genetic penetrance (0-1)
  description       String?
  riskFactors       Json?    @map("risk_factors") // array of risk factors
  symptoms          Json?    // array of symptoms
  isHereditary      Boolean  @default(false) @map("is_hereditary")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@index([category])
  @@index([isHereditary])
  @@map("genetic_conditions")
}

model FamilyRiskAssessment {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  conditionName     String   @map("condition_name")
  familyRiskScore   Float    @map("family_risk_score") // 0-1 scale
  affectedRelatives Int      @map("affected_relatives") // count of affected family members
  riskLevel         String   @map("risk_level") // low, moderate, high, very_high
  recommendations   Json?    // array of recommendations
  calculatedAt      DateTime @default(now()) @map("calculated_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, conditionName])
  @@index([riskLevel])
  @@map("family_risk_assessments")
}

model Document {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  fileName    String   @map("file_name")
  filePath    String   @map("file_path")
  fileType    String   @map("file_type")
  category    String?
  ocrText     String?  @map("ocr_text")
  metadata    Json?
  uploadedAt  DateTime @default(now()) @map("uploaded_at")
  
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("documents")
}

model AIModel {
  id          String   @id @default(cuid())
  name        String
  version     String
  modelType   String   @map("model_type")
  parameters  Json?
  accuracy    Float?
  trainedAt   DateTime @map("trained_at")
  
  predictions Prediction[]
  
  @@map("ai_models")
}

model Prediction {
  id               String   @id @default(cuid())
  userId           String   @map("user_id")
  aiModelId        String   @map("ai_model_id")
  predictionType   String   @map("prediction_type")
  inputData        Json     @map("input_data")
  predictionResult Json     @map("prediction_result")
  confidenceScore  Float?   @map("confidence_score")
  createdAt        DateTime @default(now()) @map("created_at")
  
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  aiModel AIModel @relation(fields: [aiModelId], references: [id], onDelete: Cascade)
  
  @@map("predictions")
}

model ReferenceRange {
  id           String   @id @default(cuid())
  testName     String   @map("test_name")
  testCategory String   @map("test_category")
  unit         String?
  ageMin       Int?     @map("age_min")
  ageMax       Int?     @map("age_max")
  gender       String?  // 'male', 'female', 'all'
  minValue     Float?   @map("min_value")
  maxValue     Float?   @map("max_value")
  textRange    String?  @map("text_range") // For non-numeric ranges like "negative"
  source       String?  // Reference institution
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  @@index([testName, testCategory])
  @@index([testCategory])
  @@map("reference_ranges")
}

model Appointment {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  hospitalName      String   @map("hospital_name")
  department        String
  doctorName        String?  @map("doctor_name")
  appointmentType   String   @map("appointment_type") // consultation, follow_up, procedure, test
  purpose           String?  // reason for appointment
  appointmentDate   DateTime @map("appointment_date")
  duration          Int?     // duration in minutes
  status            String   @default("scheduled") // scheduled, confirmed, completed, cancelled, no_show
  location          String?  // room number, building, etc.
  notes             String?
  
  // Contact information
  hospitalPhone     String?  @map("hospital_phone")
  hospitalAddress   String?  @map("hospital_address")
  
  // Reminder settings
  reminderSettings  Json?    @map("reminder_settings") // notification preferences
  
  // Metadata
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  notifications     AppointmentNotification[]
  
  @@index([userId, appointmentDate])
  @@index([status])
  @@index([department])
  @@map("appointments")
}

model AppointmentNotification {
  id            String   @id @default(cuid())
  appointmentId String   @map("appointment_id")
  notificationType String @map("notification_type") // email, sms, push, in_app
  scheduledTime DateTime @map("scheduled_time") // when to send the notification
  message       String?
  status        String   @default("pending") // pending, sent, failed
  sentAt        DateTime? @map("sent_at")
  errorMessage  String?  @map("error_message")
  createdAt     DateTime @default(now()) @map("created_at")
  
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  
  @@index([scheduledTime, status])
  @@map("appointment_notifications")
}

model Recommendation {
  id          String   @id @default(cuid())
  userId      String   @map("user_id")
  nutrition   Json     // Array of NutritionRecommendation objects
  exercise    Json     // Array of ExerciseRecommendation objects
  screening   Json     // Array of ScreeningRecommendation objects
  lifestyle   Json     // Array of LifestyleRecommendation objects
  generatedAt DateTime @default(now()) @map("generated_at")
  validUntil  DateTime @map("valid_until")
  confidence  Float    // Overall confidence score (0-1)
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, generatedAt])
  @@index([validUntil])
  @@map("recommendations")
}

model RecommendationEffectiveness {
  recommendationId    String   @map("recommendation_id")
  userId              String   @map("user_id")
  category            String   // nutrition, exercise, screening, lifestyle
  implemented         Boolean  @default(false)
  implementationDate  DateTime? @map("implementation_date")
  adherenceScore      Int?     @map("adherence_score") // 0-100
  measuredOutcome     Json?    @map("measured_outcome") // Before/after measurements
  userFeedback        Json?    @map("user_feedback") // Rating and comments
  lastUpdated         DateTime @default(now()) @map("last_updated")
  
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@id([recommendationId, userId])
  @@index([userId, category])
  @@index([implemented])
  @@map("recommendation_effectiveness")
}

model WearableDeviceConfig {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  deviceType   String   @map("device_type") // apple_health, google_fit, fitbit, samsung_health
  deviceName   String   @map("device_name")
  isActive     Boolean  @default(true) @map("is_active")
  accessToken  String?  @map("access_token")
  refreshToken String?  @map("refresh_token")
  lastSyncAt   DateTime? @map("last_sync_at")
  syncSettings Json     @map("sync_settings") // { autoSync, syncInterval, dataTypes }
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  wearableDataPoints WearableDataPoint[]
  wearableDataTemp   WearableDataTemp[]
  
  @@index([userId, deviceType])
  @@index([isActive])
  @@map("wearable_device_configs")
}

model WearableDataPoint {
  id               String   @id @default(cuid())
  deviceConfigId   String   @map("device_config_id")
  dataType         String   @map("data_type") // heart_rate, steps, calories, sleep, weight, etc.
  value            Json     // Can be number or object (e.g., {systolic: 120, diastolic: 80})
  unit             String
  startTime        DateTime @map("start_time")
  endTime          DateTime? @map("end_time")
  sourceApp        String?  @map("source_app")
  metadata         Json?
  syncedAt         DateTime @default(now()) @map("synced_at")
  
  deviceConfig WearableDeviceConfig @relation(fields: [deviceConfigId], references: [id], onDelete: Cascade)
  
  @@unique([deviceConfigId, dataType, startTime], name: "deviceConfigId_dataType_timestamp")
  @@index([dataType, startTime])
  @@index([syncedAt])
  @@map("wearable_data_points")
}

model WearableDataTemp {
  id             String   @id @default(cuid())
  deviceConfigId String   @map("device_config_id")
  dataType       String   @map("data_type")
  value          Float
  unit           String
  timestamp      DateTime
  endTime        DateTime? @map("end_time")
  metadata       Json?
  processed      Boolean  @default(false)
  createdAt      DateTime @default(now()) @map("created_at")
  
  deviceConfig WearableDeviceConfig @relation(fields: [deviceConfigId], references: [id], onDelete: Cascade)
  
  @@index([deviceConfigId, processed])
  @@index([timestamp])
  @@map("wearable_data_temp")
}

// Security and Audit Models

model AuditLog {
  id        String   @id @default(cuid())
  timestamp DateTime
  action    String
  userId    String?  @map("user_id")
  ip        String
  userAgent String?  @map("user_agent")
  path      String
  method    String
  details   String?  // JSON string
  hash      String
  createdAt DateTime @default(now()) @map("created_at")
  
  @@index([timestamp])
  @@index([userId])
  @@index([action])
  @@index([ip])
  @@index([hash])
  @@map("audit_logs")
}

model UserRole {
  id        String    @id @default(cuid())
  userId    String    @map("user_id")
  role      String    @default("patient")
  grantedBy String?   @map("granted_by")
  grantedAt DateTime  @default(now()) @map("granted_at")
  expiresAt DateTime? @map("expires_at")
  isActive  Boolean   @default(true) @map("is_active")
  
  @@unique([userId, role])
  @@map("user_roles")
}

model UserSession {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  sessionToken String   @unique @map("session_token")
  ipAddress    String   @map("ip_address")
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")
  lastActivity DateTime @default(now()) @map("last_activity")
  expiresAt    DateTime @map("expires_at")
  isActive     Boolean  @default(true) @map("is_active")
  
  @@index([userId])
  @@index([sessionToken])
  @@index([expiresAt])
  @@map("user_sessions")
}

model DataAccessLog {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  resourceType String   @map("resource_type")
  resourceId   String   @map("resource_id")
  accessType   String   @map("access_type")
  ipAddress    String   @map("ip_address")
  userAgent    String?  @map("user_agent")
  accessedAt   DateTime @default(now()) @map("accessed_at")
  dataHash     String?  @map("data_hash")
  purpose      String?
  
  @@index([userId])
  @@index([resourceType, resourceId])
  @@index([accessedAt])
  @@map("data_access_logs")
}

model SecurityEvent {
  id          String    @id @default(cuid())
  eventType   String    @map("event_type")
  severity    String    @default("medium")
  userId      String?   @map("user_id")
  ipAddress   String    @map("ip_address")
  userAgent   String?   @map("user_agent")
  description String
  details     Json?
  resolved    Boolean   @default(false)
  resolvedBy  String?   @map("resolved_by")
  resolvedAt  DateTime? @map("resolved_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@index([eventType])
  @@index([severity])
  @@index([resolved])
  @@index([createdAt])
  @@map("security_events")
}

model EncryptionKey {
  id        String    @id @default(cuid())
  keyName   String    @unique @map("key_name")
  keyVersion Int      @default(1) @map("key_version")
  algorithm String    @default("aes-256-gcm")
  keyHash   String    @map("key_hash")
  createdAt DateTime  @default(now()) @map("created_at")
  expiresAt DateTime? @map("expires_at")
  isActive  Boolean   @default(true) @map("is_active")
  createdBy String?   @map("created_by")
  
  @@index([keyName])
  @@index([isActive])
  @@map("encryption_keys")
}

model BackupLog {
  id             String    @id @default(cuid())
  backupType     String    @map("backup_type")
  tableName      String?   @map("table_name")
  backupSize     BigInt?   @map("backup_size")
  backupLocation String    @map("backup_location")
  backupHash     String    @map("backup_hash")
  startedAt      DateTime  @map("started_at")
  completedAt    DateTime? @map("completed_at")
  status         String    @default("in_progress")
  errorMessage   String?   @map("error_message")
  createdBy      String?   @map("created_by")
  
  @@index([backupType])
  @@index([status])
  @@index([startedAt])
  @@map("backup_logs")
}

model ComplianceReport {
  id                String   @id @default(cuid())
  reportType        String   @map("report_type")
  reportPeriodStart DateTime @map("report_period_start")
  reportPeriodEnd   DateTime @map("report_period_end")
  generatedBy       String   @map("generated_by")
  generatedAt       DateTime @default(now()) @map("generated_at")
  reportData        Json     @map("report_data")
  reportHash        String   @map("report_hash")
  filePath          String?  @map("file_path")
  status            String   @default("generated")
  
  @@index([reportType])
  @@index([reportPeriodStart, reportPeriodEnd])
  @@index([generatedAt])
  @@map("compliance_reports")
}

model UserConsent {
  id            String    @id @default(cuid())
  userId        String    @map("user_id")
  consentType   String    @map("consent_type")
  consentVersion String   @map("consent_version")
  granted       Boolean
  grantedAt     DateTime  @default(now()) @map("granted_at")
  withdrawnAt   DateTime? @map("withdrawn_at")
  ipAddress     String    @map("ip_address")
  userAgent     String?   @map("user_agent")
  consentText   String    @map("consent_text")
  
  @@unique([userId, consentType, consentVersion])
  @@index([userId])
  @@index([consentType])
  @@index([granted])
  @@map("user_consents")
}

model DataRetentionPolicy {
  id                  String   @id @default(cuid())
  tableName           String   @map("table_name")
  retentionPeriodDays Int      @map("retention_period_days")
  policyType          String   @map("policy_type")
  description         String?
  createdBy           String   @map("created_by")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @default(now()) @updatedAt @map("updated_at")
  isActive            Boolean  @default(true) @map("is_active")
  
  @@index([tableName])
  @@index([isActive])
  @@map("data_retention_policies")
}

// Remote Monitoring Models
model RemoteMonitoringSession {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  sessionType       String   @map("session_type")
  status            String   @default("active")
  startTime         DateTime @map("start_time")
  endTime           DateTime? @map("end_time")
  monitoringDevices Json?    @map("monitoring_devices")
  alertSettings     Json?    @map("alert_settings")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  healthAlerts      HealthAlert[]
  realTimeHealthData RealTimeHealthData[]
  
  @@index([userId, status])
  @@map("remote_monitoring_sessions")
}

model RealTimeHealthData {
  id                        String   @id @default(cuid())
  remoteMonitoringSessionId String   @map("remote_monitoring_session_id")
  dataType                  String   @map("data_type")
  value                     Json
  unit                      String
  timestamp                 DateTime
  deviceId                  String?  @map("device_id")
  isAbnormal                Boolean  @default(false) @map("is_abnormal")
  createdAt                 DateTime @default(now()) @map("created_at")
  
  session RemoteMonitoringSession @relation(fields: [remoteMonitoringSessionId], references: [id], onDelete: Cascade)
  
  @@index([remoteMonitoringSessionId, timestamp])
  @@index([dataType, timestamp])
  @@map("real_time_health_data")
}

model HealthAlert {
  id                        String   @id @default(cuid())
  remoteMonitoringSessionId String   @map("remote_monitoring_session_id")
  alertType                 String   @map("alert_type")
  severity                  String
  message                   String
  triggerData               Json?    @map("trigger_data")
  isResolved                Boolean  @default(false) @map("is_resolved")
  resolvedAt                DateTime? @map("resolved_at")
  createdAt                 DateTime @default(now()) @map("created_at")
  
  session RemoteMonitoringSession @relation(fields: [remoteMonitoringSessionId], references: [id], onDelete: Cascade)
  
  @@index([remoteMonitoringSessionId, isResolved])
  @@index([severity, createdAt])
  @@map("health_alerts")
}

model HealthcareDataShare {
  id               String   @id @default(cuid())
  userId           String   @map("user_id")
  recipientType    String   @map("recipient_type")
  recipientId      String   @map("recipient_id")
  dataTypes        Json     @map("data_types")
  permissions      Json
  expiresAt        DateTime? @map("expires_at")
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  
  @@index([userId, isActive])
  @@map("healthcare_data_shares")
}

// Telehealth Models
model TelehealthIntegration {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  platformName      String   @map("platform_name")
  platformId        String   @map("platform_id")
  accessToken       String?  @map("access_token")
  refreshToken      String?  @map("refresh_token")
  isActive          Boolean  @default(true) @map("is_active")
  lastSyncAt        DateTime? @map("last_sync_at")
  integrationConfig Json?    @map("integration_config")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  sessions TelehealthSession[]
  
  @@index([userId, platformName])
  @@map("telehealth_integrations")
}

model TelehealthSession {
  id                      String   @id @default(cuid())
  telehealthIntegrationId String   @map("telehealth_integration_id")
  sessionId               String   @map("session_id")
  doctorName              String   @map("doctor_name")
  specialty               String?
  sessionType             String   @map("session_type")
  scheduledTime           DateTime @map("scheduled_time")
  actualStartTime         DateTime? @map("actual_start_time")
  actualEndTime           DateTime? @map("actual_end_time")
  status                  String   @default("scheduled")
  sessionNotes            String?  @map("session_notes")
  diagnosis               String?
  prescriptions           Json?
  followUpRequired        Boolean  @default(false) @map("follow_up_required")
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")
  
  integration TelehealthIntegration @relation(fields: [telehealthIntegrationId], references: [id], onDelete: Cascade)
  
  @@index([telehealthIntegrationId, scheduledTime])
  @@index([status])
  @@map("telehealth_sessions")
}

// Research Participation Models
model ResearchParticipation {
  id                String   @id @default(cuid())
  userId            String   @map("user_id")
  studyId           String   @map("study_id")
  studyTitle        String   @map("study_title")
  studyType         String   @map("study_type")
  participationDate DateTime @map("participation_date")
  status            String   @default("active")
  consentGiven      Boolean  @default(false) @map("consent_given")
  dataShared        Json?    @map("data_shared")
  incentivesEarned  Float    @default(0) @map("incentives_earned")
  completionDate    DateTime? @map("completion_date")
  withdrawalReason  String?  @map("withdrawal_reason")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  @@index([userId, status])
  @@index([studyId])
  @@map("research_participations")
}

model UserIncentive {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  incentiveType   String   @map("incentive_type")
  description     String
  pointsEarned    Float    @map("points_earned")
  pointsRedeemed  Float    @default(0) @map("points_redeemed")
  earnedDate      DateTime @map("earned_date")
  redeemedDate    DateTime? @map("redeemed_date")
  expiresAt       DateTime? @map("expires_at")
  status          String   @default("active")
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at")
  
  @@index([userId, status])
  @@index([incentiveType])
  @@map("user_incentives")
}